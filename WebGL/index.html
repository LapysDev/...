<!DOCTYPE html>
<!--[if lt IE 7]> <html class="internet-explorer-5 internet-explorer-6"> <![endif]-->
<!--[if IE 7]> <html class=internet-explorer-7> <![endif]-->
<!--[if IE 8]> <html class=internet-explorer-8> <![endif]-->
<!--[if IE 9]> <html class=internet-explorer-9> <![endif]-->
<html>
<head>
    <!-- Document Metadata -->
        <!-- Character Encoding Set -->
        <meta charset=utf-8>

    <!-- Document Stylesheet -->
    <style media=all type=text/css>
        /* DOM Elements */
            /* [All] */
            * { border-spacing: 0; box-sizing: inherit }

            /* <body> */
            body { display: table-row; margin: 0 }

            /* <body>, <html>, <main> */
            body, html, main { box-sizing: content-box; height: 100%; width: 100% }

            /* <html> */
            html { display: table }

            /* <main> */
            main {
                background-color: #000000;
                display: table-cell;
                overflow: hidden;
                vertical-align: middle
            }

        /* Components */
            /* Canvas */
            #canvas {
                background-color: #000000;
                display: block;
                margin: auto;
                outline: 1px solid #999999
            }
    </style>

    <!-- Document Title -->
    <title> WebGL </title>
</head>

<body>
    <!-- Main -->
    <main>
        <!-- Canvas -->
        <canvas id=canvas> </canvas>
    </main>

    <!-- Scripts -->
        <!-- GL Matrix -->
        <script language=javascript src=gl-matrix.min.js type=text/javascript> </script>

        <!-- Polyfill -->
        <script language=javascript src=polyfill.js type=text/javascript> </script>

        <!-- Document Script -->
        <script defer language=javascript type=application/javascript>
            /* Main */
            +(function Main() {
                /* Constant > ... */
                const CANVAS = document.getElementById("canvas") || document.createElement("canvas");
                const DATA = {};
                const GLOBAL = (function() { try { return Function("return this")() || eval("this") } catch (error) {} return typeof self == "undefined" ? (typeof window == "undefined" ? (typeof global == "undefined" ? undefined : global) : window) : self })();
                const RENDERER = CANVAS.getContext("webgl");
                let STRICT;

                /* Modification */
                    // Renderer
                        // Attach Shaders
                        RENDERER.attachShaders = function attachShaders(Program, ShaderCollection) { ShaderCollection.foreach(function(Shader) { RENDERER.attachShader(Program, Shader) }) };

                        // Create Buffer
                        RENDERER.createBuffer = (function() {
                            // Constant > Method
                            const METHOD = RENDERER.createBuffer;

                            // Return
                            return function createBuffer(BufferType) {
                                // Constant > (Renderer, Buffer)
                                const RENDERER = this;
                                const BUFFER = METHOD.call(RENDERER);

                                // Renderer > Bind Buffer
                                arguments.length && RENDERER.bindBuffer(BufferType, BUFFER);

                                // Return
                                return BUFFER
                            }
                        })();

                        // Create Shader
                        RENDERER.createShader = (function() {
                            // Constant > Method
                            const METHOD = RENDERER.createShader;

                            // Return
                            return function createShader(ShaderType, ShaderSourceScriptURL = null) {
                                // Constant > (Renderer, Shader)
                                const RENDERER = this;
                                const SHADER = METHOD.call(RENDERER, ShaderType);

                                // Renderer > Read Source
                                (ShaderSourceScriptURL === null) || RENDERER.readSource(ShaderSourceScriptURL).then(function(ShaderSourceScript) {
                                    // Renderer > (Shader Source, Compile Shader)
                                    RENDERER.shaderSource(SHADER, ShaderSourceScript);
                                    RENDERER.compileShader(SHADER)
                                });

                                // Return
                                return SHADER
                            }
                        })();

                        // Create Vertex
                        RENDERER.createVertex = function createVertex(CoordinatesA, CoordinatesB, CoordinatesC) { return new Float32Array([CoordinatesA, CoordinatesB, CoordinatesC].flat()) };

                        // Is Ready
                        RENDERER.def("isReady", {get: function isReady() { return !RENDERER.numberOfSourcesBeingRead }});

                        // Number Of Sources Being Read
                        RENDERER.numberOfSourcesBeingRead = +0;

                        // Read Source
                        RENDERER.readSource = function readSource(URL) {
                            // Constant > (Promises, XML HTTP Request)
                            const PROMISES = [];
                            const XML_HTTP_REQUEST = new XMLHttpRequest;

                            // Modification > Renderer > Number Of Sources Being Read
                            RENDERER.numberOfSourcesBeingRead += 1;

                            // Event > XML HTTP Request
                            XML_HTTP_REQUEST.addEventListener("loadend", function acquireSource() {
                                // Deletion
                                XML_HTTP_REQUEST.removeEventListener("loadend", acquireSource);

                                // Loop > Promise
                                PROMISES.foreach(function(Promise) { Promise.call(XML_HTTP_REQUEST, XML_HTTP_REQUEST.responseText) });

                                // Modification > Renderer > Number Of Sources Being Read
                                RENDERER.numberOfSourcesBeingRead -= 1
                            });

                            // XML HTTP Request > (Open, Send)
                            XML_HTTP_REQUEST.open("GET", URL);
                            XML_HTTP_REQUEST.send();

                            // Return
                            return {then: function then(Handler) { PROMISES.push(Handler); return this }}
                        };

                /* Global > ... */
                GLOBAL.CANVAS = CANVAS;
                GLOBAL.DATA = DATA;
                GLOBAL.GLOBAL = GLOBAL;
                GLOBAL.RENDERER = RENDERER;

                /* Phases */
                    // Initiate
                    function Initiate() {
                        /* Function */
                            /* Resize Canvas */
                            function ResizeCanvas() {
                                // Constant > Canvas (Size, Style)
                                const CANVAS_SIZE = Math.min(innerHeight, innerWidth);
                                const CANVAS_STYLE = CANVAS.style;

                                // Modification > Canvas (Style) > (Height, Width)
                                CANVAS.height = CANVAS_SIZE;
                                CANVAS.width = CANVAS_SIZE;

                                CANVAS_STYLE.height = CANVAS_SIZE + "px";
                                CANVAS_STYLE.width = CANVAS_SIZE + "px"
                            }

                            /* Setup WebGL  --- NOTE (Lapys) -> Setup the OpenGL API in JavaScript`s WebGL form. */
                            function SetupWebGL() {}

                        /* Events > Global > Resize */
                        GLOBAL.addEventListener("resize", ResizeCanvas);

                        // ...
                        ResizeCanvas();
                        SetupWebGL();

                        const PROGRAM = RENDERER.createProgram();

                        const FRAGMENT_SHADER = RENDERER.createShader(RENDERER["FRAGMENT_SHADER"], "fragment-shader.txt");
                        const VERTEX_SHADER = RENDERER.createShader(RENDERER["VERTEX_SHADER"], "vertex-shader.txt");

                        const BUFFER = RENDERER.createBuffer(RENDERER["ARRAY_BUFFER"]);
                        const VERTEX_DATA = RENDERER.createVertex([+0, 1, +0], [1, -1, +0], [-1, -1, +0]);

                        RENDERER.bufferData(RENDERER["ARRAY_BUFFER"], VERTEX_DATA, RENDERER["STATIC_DRAW"]);

                        check(function() { return RENDERER.isReady }, null, function() {
                            RENDERER.attachShaders(PROGRAM, [FRAGMENT_SHADER, VERTEX_SHADER]);
                            RENDERER.linkProgram(PROGRAM);

                            const POSITION_ATTRIBUTE_LOCATION = RENDERER.getAttribLocation(PROGRAM, "POSITION");

                            RENDERER.enableVertexAttribArray(POSITION_ATTRIBUTE_LOCATION);
                            RENDERER.vertexAttribPointer(POSITION_ATTRIBUTE_LOCATION, 3, RENDERER["FLOAT"], STRICT = false, STRICT = +0, STRICT = +0);

                            RENDERER.useProgram(PROGRAM);

                            RENDERER.drawArrays(RENDERER["TRIANGLES"], STRICT = +0, STRICT = 3)
                        });

                        // Return
                        return +0
                    }

                // ...
                Initiate();

                // Return
                return +0
            })()
        </script>
</body>
</html>
