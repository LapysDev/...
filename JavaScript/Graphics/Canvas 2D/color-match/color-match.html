<!DOCTYPE html>
<html>
  <head>
    <!-- Document Stylesheet -->
    <style media=all type=text/css>
      /* @font-face */
      @font-face { font-family: "Google Sans";                                   src: local("Google Sans"), url(fonts/google_sans.ttf)        format("opentype") }
      @font-face { font-family: "Google Sans"; font-weight: 500 600 700 800 900; src: local("Google Sans"), url(fonts/google_sans-bold.ttf)   format("opentype") }
      @font-face { font-family: "Google Sans"; font-style: italic;               src: local("Google Sans"), url(fonts/google_sans-italic.ttf) format("opentype") }

      /* <body>  */
      body {
        background-color: #FCFCFC;
        font-family     : "Google Sans", sans-serif;
        overflow-x      : hidden
      }

      /* <body>, <html> */
      body, html {
        height: 100%;
        margin: 0;
        width : 100%
      }

      /* <table> */
      table {
        border-collapse: collapse;
        border-spacing : 0;
        table-layout   : fixed
      }

      /* Features */
        /* Canvas */
        #canvas {
          bottom    : 0;
          box-shadow: 0 0 0 4000px rgba(0, 0, 0, 0.075), inset 0 0 0 4000px rgba(0, 0, 0, 0.075);
          left      : 0;
          margin    : auto;
          max-height: 100%;
          max-width : 100%;
          position  : absolute;
          right     : 0;
          top       : 0
        }

        /* Display */
        #display {
          background-color: #090909;
          box-shadow      : inset 0 0 1080px 0 rgba(0, 0, 0, 0.05);
          height          : 100%;
          left            : 0;
          margin-left     : auto;
          margin-right    : auto;
          outline         : 1px solid #666666;
          overflow        : hidden;
          /*position        : absolute;*/
          right           : 0;
          top             : 0;
          width           : 100%
        }

        #display.active {
          background-image: url(images/transparent.png);
          position        : relative
        }

        #display, #display .render { color: #F0F0F0 }
          /* @media */
          @media (max-height: 4320px) and (max-width: 7680px) { #display.active { background-image: url(images/transparent-4320p.png) } }
          @media (max-height: 2160px) and (max-width: 3840px) { #display.active { background-image: url(images/transparent-2160p.png) } }
          @media (max-height: 1440px) and (max-width: 2560px) { #display.active { background-image: url(images/transparent-1440p.png) } }
          @media (max-height: 1080px) and (max-width: 1920px) { #display.active { background-image: url(images/transparent-1080p.png) } }
          @media (max-height: 720px)  and (max-width: 1280px) { #display.active { background-image: url(images/transparent-720p.png)  } }

          /* Information Box */
          #display .info-box {
            background-color: #0F0F0F;
            background-color: rgba(0, 0, 0, 0.95);
            border          : 1px solid #AFAFAF;
            border-radius   : 3px;
            color           : rgba(255, 255, 255, 0.8);
            color           : #CFCFCF;
            font-style      : italic;
            opacity         : 0.0;
            padding-bottom  : 5px;
            padding-left    : 10px;
            padding-right   : 10px;
            padding-top     : 5px;
            pointer-events  : none;
            position        : absolute;
            right           : -10%;
            top             : -10%;
            touch-action    : none;
            transition      : right, top 650ms ease-in 0ms;
            user-select     : none;
            visibility      : hidden
          }

          #display .info-box.active {
            opacity   : 1.0;
            right     : 1%;
            top       : 1%;
            visibility: visible
          }
            /* ::selection */
            #display .info-box::selection {
              background-color: #0F0F0F;
              background-color: rgba(0, 0, 0, 0.95);
              color           : rgba(255, 255, 255, 0.8);
              color           : #CFCFCF;
              text-shadow     : none
            }

          /* Input Box */
          #display .input-box {
            background-color: rgba(0, 0, 0, 0.15);
            bottom          : 5%;
            font-size       : 110%;
            left            : 15%;
            position        : absolute;
            right           : 15%;
            text-align      : center;
            transition      : all 150ms linear 0ms;
            width           : 70%
          }

          #display .input-box.hidden { background-color: rgba(0, 0, 0, 0) }
            /* <tbody>, <tr> */
            #display .input-box.hidden tbody,
            #display .input-box.hidden tr { transition: inherit }

            /* Input (Field, Toggle) */
            #display .input-field,
            #display .input-toggle {
              opacity       : 1.0;
              padding-left  : 3%;
              padding-bottom: 5px;
              padding-right : 3%;
              padding-top   : 5px;
              transition    : inherit
            }

            #display .input-box.hidden .input-field,
            #display .input-box.hidden .input-toggle {
              opacity            : 0.0;
              transition-duration: inherit
            }
              /* ... */
              #display .input-field input,
              #display .input-toggle button {
                border-radius: 3px;
                transition   : all 100ms ease-in 0ms
              }
                /* :hover */
                #display .input-field input:focus,
                #display .input-toggle button:focus {
                  border-color: #0099FF;
                  outline     : none
                }

            /* Input Field  */
            #display .input-field {
              text-align         : right;
              transition-duration: 110ms;
              visibility         : visible
            }

            #display .input-box.hidden .input-field { visibility: hidden }
              /* <input> */
              #display .input-field input {
                background-color: rgba(0, 0, 0, 0);
                border          : 1px solid #AFAFAF;
                color           : #999999;
                cursor          : default;
                font            : inherit;
                float           : right;
                padding         : 1%;
                width           : 98%
              }

              #display.active .input-field input {
                background-color: #FFFFFF;
                background-color: rgba(255, 255, 255, 0.675);
                color           : #333333
              }

            /* Input Toggle */
            #display .input-toggle {
              letter-spacing: 2px;
              text-align    : left;
              width         : 25%
            }
              /* <button> */
              #display .input-toggle button {
                background-color: #FFFFFF;
                border          : 1px solid #999999;
                border-radius   : 50%;
                box-shadow      : 2px 3px 0 1px rgba(0, 0, 0, 0.375);
                color           : #3F3F3F;
                cursor          : pointer;
                float           : left;
                font-size       : 125%;
                font-weight     : 700;
                letter-spacing  : inherit;
                line-height     : 0;
                height          : 50px;
                padding         : 0;
                text-align      : center;
                touch-action    : none;
                transform       : translateY(0px);
                user-select     : none;
                width           : 50px
              }

              #display .input-box.hidden .input-toggle:hover { opacity: 1.0 }
                /* ::selection */
                #display .input-toggle button::selection {
                  background-color: inherit;
                  color           : inherit;
                  text-shadow     : inherit
                }

                /* :hover */
                #display .input-toggle button:hover {
                  box-shadow: 1px 3px 0 5px rgba(0, 0, 0, 0.25);
                  transform : translateY(-3px)
                }

                /* :focus, :hover */
                #display .input-toggle button:focus,
                #display .input-toggle button:hover { color: #333333 }

                /* :active */
                #display .input-toggle button:active {
                  box-shadow         : 2px 3px 0 1px rgba(0, 0, 0, 0.375);
                  transform          : translateY(-1px);
                  transition-duration: 50ms
                }

          /* Render */
          #display .render {
            font-size     : 48px;
            font-weight   : 600;
            height        : 100%;
            pointer-events: none;
            text-align    : center;
            user-select   : none;
            vertical-align: middle;
            width         : 100%
          }

          #display.active .render { pointer-events: auto }
            /* ::selection */
            #display .render ::selection {
              background-color: inherit;
              color           : inherit;
              text-shadow     : inherit
            }

        /* Display, Palette  */
          /* <td>, <th> */
          #display td,
          #palette td,
          #palette th { padding: 0 }

        /* Palette */
        #palette {
          background-color   : transparent;
          background-color   : rgba(255, 255, 255, 0.0);
          background-color   : inherit;
          color              : #333333;
          font-size          : 24px;
          border-bottom-width: 20px;
          border-color       : transparent;
          border-color       : rgba(255, 255, 255, 0.0);
          border-style       : solid;
          border-top-width   : 45px;
          margin-left        : 10%;
          margin-right       : 10%;
          touch-action       : none;
          user-select        : none;
          width              : 80%
        }
          /* <table> */
          #palette table { width: 100% }
            /* Colors */
            #palette .colors { width: 80% }
              /* Color (Range, Unit) */
              #palette .color-range,
              #palette .color-unit { opacity: 0.95 }
                /* :hover */
                #palette .color-range:hover,
                #palette .color-unit:hover { opacity: 1.0 }

              /* Color Unit */
              #palette .color-unit {
                animation    : color_unit__entry 250ms ease-in 0ms 1 normal forwards running;
                border       : 1px solid #CCCCCC;
                border-radius: 5px;
                float        : left;
                height       : 25px;
                left         : 300px;
                margin-bottom: 2px;
                margin-left  : 3px;
                margin-right : 3px;
                margin-top   : 2px;
                position     : relative;
                width        : 25px
              }
                @keyframes color_unit__entry {
                  000% { left: 200px }
                  100% { left: 0px }
                }

              /* Ranges */
              #palette .colors .ranges {
                border-radius : 8px;
                box-shadow    : 0 0 0 1px #CFCFCF;
                height        : 6px;
                margin-bottom : 4px;
                margin-top    : 10px;
                opacity       : 0.85;
                outline       : 1px solid #F0F0F0;
                outline-offset: 2px;
                overflow      : hidden;
                width         : 100%
              }

              /* Ranges, Units */
              #palette .colors .ranges,
              #palette .colors .units { width: 100% }

              /* Units */
              #palette .colors .units { opacity : 0.95 }
                /* <td> */
                #palette .colors .units td {
                  overflow-x    : hidden;
                  padding-bottom: 3px;
                  padding-top   : 3px
                }

            /* Colors, Download */
            #palette .colors .ranges,
            #palette .colors .units,
            #palette .download { transition: all 300ms ease-in 0ms }
              /* :hover */
              #palette .colors .ranges:hover,
              #palette .colors .units:hover,
              #palette .download:hover { opacity: 1.0 }

            /* Download */
            #palette .download {
              font-weight        : 900;
              opacity            : 0.9;
              padding-right      : 5%;
              text-align         : right;
              transition-duration: 100ms;
              width              : auto
            }
              /* <a> */
              #palette .download a {
                color          : inherit;
                cursor         : pointer;
                text-decoration: none
              }
                /* :visited */
                #palette .download a:visited { color: inherit }

          /* <td> */
          #palette td { width: 75% }

          /* <th> */
          #palette th {
            padding   : 5px;
            text-align: left
          }

          /* Format, Step */
            /* <input> */
            #palette .format select,
            #palette .step input {
              color       : inherit;
              font        : inherit;
              touch-action: inherit;
              user-select : inherit
            }

            /* <td>, <th> */
            #palette .format td,
            #palette .format th,
            #palette .step td,
            #palette .step th {
              padding-top: 20px
            }

          /* Format */
            /* <select> */
            #palette .format select {
              font-size: 90%
            }

        /* Tooltip */
        #tooltip {
          background-color   : #060606;
          background-color   : rgba(6, 6, 6, 0.95);
          border             : 1px solid #FFFFFF;
          border-color       : rgba(255, 255, 255, 0.3);
          border-radius      : 2px;
          box-shadow         : 0 3px 3px 0 rgba(0, 0, 0, 0.25);
          color              : rgba(255, 255, 255, 0.9);
          color              : #F0F0F0;
          display            : inline-block;
          float              : left;
          font-family        : sans-serif;
          font-size          : 16px;
          font-weight        : 300;
          min-height         : 16px;
          min-width          : 16px;
          opacity            : 1.0;
          padding            : 3px;
          pointer-events     : none;
          position           : absolute;
          position           : fixed;
          overflow           : hidden;
          overflow-wrap      : break-word;
          touch-action       : none;
          transition         : 100ms linear 300ms;
          transition-property: background-color, border-color, color, opacity;
          user-select        : none;
          visibility         : visible;
          white-space        : pre;
          word-break         : break-word;
          word-wrap          : break-word
        }

        #tooltip.hidden {
          background-color   : rgba(6, 6, 6, 0.0);
          border-color       : rgba(255, 255, 255, 0.0);
          color              : rgba(255, 255, 255, 0.0);
          font-size          : 0px;
          left               : -16px !important;
          min-height         : 0;
          min-width          : 0;
          opacity            : 0.0;
          top                : -16px !important;
          transition-duration: 0ms;
          visibility         : hidden;
          z-index            : 2147483647
        }
          /* ::selection */
          #tooltip::selection {
            background-color: initial;
            background-color: rgba(0, 0, 0, 0.9);
            color           : #FFFFFF;
            color           : rgba(255, 255, 255, 0.9);
            text-shadow     : none
          }
    </style>
  </head>

  <body>
    <noscript>
    </noscript>

    <div id=display>
      <table class=render style="min-height: 320px; min-width: 480px">
        <tbody>
          <tr>
            <td id=output> No picture displayed </td>
          </tr>
        </tbody>
      </table>

      <table class=input-box>
        <tbody>
          <tr>
            <td class=input-field> <input accept=image/* disabled id=input title="Send a picture" type="file"/> </td>
            <td class=input-toggle> <button id=toggle title="Toggle controls">&#128065;</button> </td>
          </tr>
        </tbody>
      </table>

      <div class=info-box> Processing picture… </div>
    </div>

    <table id=palette>
      <tbody>
        <tr class=raw>
          <th> Colors </th>
          <td>
            <table>
              <tbody>
                <tr>
                  <td class=colors>
                    <table class=units>
                      <tbody>
                        <tr>
                          <td>
                            <div class=color-unit style="animation-delay: 0ms;   background-color: #000000" title=#000000> </div>
                            <div class=color-unit style="animation-delay: 30ms;  background-color: #FF0000" title=#FF0000> </div>
                            <div class=color-unit style="animation-delay: 60ms;  background-color: #00FF00" title=#00FF00> </div>
                            <div class=color-unit style="animation-delay: 90ms;  background-color: #0000FF" title=#0000FF> </div>
                            <div class=color-unit style="animation-delay: 120ms; background-color: #FFFF00" title=#FFFF00> </div>
                            <div class=color-unit style="animation-delay: 150ms; background-color: #FF00FF" title=#FF00FF> </div>
                            <div class=color-unit style="animation-delay: 180ms; background-color: #00FFFF" title=#00FFFF> </div>
                            <div class=color-unit style="animation-delay: 210ms; background-color: #FFFFFF" title=#FFFFFF> </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </td>

                  <td class=download>
                    <a class=download-link download target=_self title=Download>&#11123;</a>
                  </td>
                </tr>

                <tr>
                  <td class=colors>
                    <table class=ranges>
                      <tbody>
                        <tr>
                          <td class=color-range style="background-color: #000000; width: 38.248478%" title=#000000> </td>
                          <td class=color-range style="background-color: #FF0000; width: 19.115765%" title=#FF0000> </td>
                          <td class=color-range style="background-color: #00FF00; width: 17.255064%" title=#00FF00> </td>
                          <td class=color-range style="background-color: #0000FF; width: 12.478175%" title=#0000FF> </td>
                          <td class=color-range style="background-color: #FFFF00; width: 05.453096%" title=#FFFF00> </td>
                          <td class=color-range style="background-color: #FF00FF; width: 04.441672%" title=#FF00FF> </td>
                          <td class=color-range style="background-color: #00FFFF; width: 02.836903%" title=#00FFFF> </td>
                          <td class=color-range style="background-color: #FFFFFF; width: 00.170843%" title=#FFFFFF> </td>
                        </tr>
                      </tbody>
                    </table>
                  </td>
                  <td class=download></td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>

        <tr class=unique>
          <th></th>
          <td>
            <table>
              <tbody>
                <tr>
                  <td class=colors>
                    <table class=units>
                      <tbody>
                        <tr>
                          <td>
                            <div class=color-unit style="animation-delay: 0ms;  background-color: #FF0000" title=#FF0000> </div>
                            <div class=color-unit style="animation-delay: 30ms; background-color: #00FF00" title=#00FF00> </div>
                            <div class=color-unit style="animation-delay: 60ms; background-color: #0000FF" title=#0000FF> </div>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </td>

                  <td class=download>
                    <a class=download-link download target=_self title=Download>&#11123;</a>
                  </td>
                </tr>

                <tr>
                  <td class=colors>
                    <table class=ranges>
                      <tbody>
                        <tr>
                          <td class=color-range style="background-color: #000000; width: 27.821445%" title=#000000> </td>
                          <td class=color-range style="background-color: #FF0000; width: 33.298922%" title=#FF0000> </td>
                          <td class=color-range style="background-color: #00FF00; width: 38.879631%" title=#00FF00> </td>
                        </tr>
                      </tbody>
                    </table>
                  </td>

                  <td class=download></td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>

        <tr class=format>
          <th> Format </th>
          <td>
            <select disabled id=format value=Hexadecimal>
              <option value=cmyk> CMYK </option>
              <option selected value=hexadecimal> Hexadecimal </option>
              <option value=hsl> HSL </option>
              <option value=rgb> RGB </option>
            </select>
          </td>
        </tr>

        <tr class=step>
          <th> Range </th>
          <td> <input disabled id=step max=255 min=1 step=1 type=number value="31"/> </td>
        </tr>
      </tbody>
    </table>

    <div class=hidden id=tooltip>&nbsp;</div>

    <!-- Document Script -->
    <script language=javascript type=text/javascript>
      /* Main */
      ;void function(display, format, input, palette, output, step, text, toggle, tooltip) {
        var adjustTarget        = null;
        var canvas              = document.createElement("canvas");
        var context             = "function" === typeof canvas.getContext ? canvas.getContext("2d", {"alpha": true}) : null;
        var extrapolatedOutput  = false;
        var extrapolatingOutput = false;
        var image               = document.createElement("img");
        var imageName           = "";
        var outputHeight        = +0;
        var outputWidth         = +0;
        var showingHUD          = true;
        var tooltipTarget       = null;

        /* Function > ... */
        // : [Adjust Input] ->> Ensure all `input` values are accurate
        function adjustInput(input) {
          if (null !== adjustTarget) return;
          var wait = setInterval(function() {
            if (false === extrapolateOutput()) return;
            adjustTarget = null;

            clearInterval(wait);
            disableInformation();
            enableInput();
            input.focus();
            showOutput();
          });

          // ...
          adjustTarget    = input;
          format.value    = format.value || "hexadecimal";
          step.value      = (+step.value | +0) || 1;

          disableInput();
          enableInformation();
          extrapolateOutput()
        }

        // : [Adjust Output] ->> Resize `canvas` to fit the `output` render
        function adjustOutput() {
          var bounds = output.getBoundingClientRect();
          var height = bounds.bottom - bounds.top;
          var width  = bounds.right - bounds.left;

          // ... ->> Got frustrated with respecting the `image`'s aspect ratio in regards to the `image` render
          outputHeight = image.height;
          outputWidth  = image.width;

          if (false) {}
          else if (height > width && outputHeight > outputWidth) { outputHeight *= width  / outputWidth;  outputWidth  = width  }
          else if (height < width && outputHeight > outputWidth) { outputWidth  *= height / outputHeight; outputHeight = height }
          else if (height < width && outputHeight < outputWidth) { outputWidth  *= height / outputHeight; outputHeight = height }
          else if (height > width && outputHeight < outputWidth) { outputHeight *= width  / outputWidth;  outputWidth  = width  }
          else { var boundsSize = height < width ? height : width; outputHeight = outputWidth = boundsSize }

          // ... ->> For bitwise floating-point truncation
          if (outputHeight > 2147483647 || outputWidth > 2147483647) {
            if (outputHeight > outputWidth) { outputWidth *= 2147483647 / outputHeight; outputHeight = 2147483647 }
            else { outputHeight *= 2147483647 / outputWidth; outputWidth = 2147483647 }
          }

          // ...
          canvas.style.height = (canvas.height = (outputHeight |= +0)) + "px";
          canvas.style.width  = (canvas.width  = (outputWidth  |= +0)) + "px";
          context.imageSmoothingEnabled = false;
          context.imageSmoothingQuality = "low";

          return showOutput()
        }

        // : [Diagnose Output] ->> Could not display the specified `input` image
        function diagnoseOutput() {
          display.className = "";

          if (output === canvas.parentNode)
          output.removeChild(canvas);

          if (null !== text) {
            output.appendChild(text);
            ext.data = "Could not display picture"
          }
        }

        // : [Disable Information]
        function disableInformation() {
          var information = getElementByClassName(display, "info-box");
          if (null !== information) information.className = "info-box"
        }

        // : [Disable Input]
        function disableInput() {
          format.disabled = true;
          input.disabled  = true;
          step.disabled   = true
        }

        // : [Enable Input]
        function enableInput() {
          format.disabled = false;
          input.disabled  = false;
          step.disabled   = false
        }

        // : [Extrapolate Output]
        function extrapolateOutput() {
          if (extrapolatingOutput) {
            if (extrapolatedOutput) {
              extrapolatedOutput  = false;
              extrapolatingOutput = false;

              return true
            }

            return false
          }

          // ...
          var colorCount      = +0;
          var colorRatios     = [];
          var colorValues     = [];
          var extracted       = false;
          var extractionIndex = +0;
          var filtered        = false;
          var imageData       = context.getImageData(+0, +0, canvas.width, canvas.height);
          var imageColors     = imageData.data;
          var imageSize       = imageColors.length;
          var inputTitle      = input.title;
          var rawOutput       = getElementByClassName(palette, "raw");
          var stepColor       = 0x010101 * +step.value;
          var uniqueOutput    = getElementByClassName(palette, "unique");
          var wait = setInterval(function() {
            if (false === extracted) { if (false === extract(1e6)) return; extracted = true }
            if (false === filtered)  { if (false === filter (1e7)) return; filtered  = true }

            clearInterval(wait);
            extrapolatedOutput = true;
            imageSize         /= 4;
            input.title        = inputTitle;

            for (var index = colorRatios.length; index; )
            colorRatios[--index] /= imageSize;

            // ... ->> Sort the colors in order of amount
            for (var index = colorCount; --index; ) {
              var ratio = colorRatios[index];

              if (ratio > colorRatios[index - 1]) {
                var value = colorValues[index];

                colorRatios[index - 0] = colorRatios[index - 1];
                colorRatios[index - 1] = ratio;
                colorValues[index - 0] = colorValues[index - 1];
                colorValues[index - 1] = value;
                index = colorCount
              }
            }

            // ... ->> Output the colors
            show(rawOutput);
            show(uniqueOutput)
          });

          // Function > ...
          function extract(count) {
            var count = count;

            // ...
            extraction:
            for (var index = extractionIndex, subindex; index <= imageSize; index += 4) {
              var currentColor = (imageColors[index + 0] << 0x00) | (imageColors[index + 1] << 0x08) | (imageColors[index + 2] << 0x10);

              // ...
              for (subindex = colorCount; subindex; ) {
                var recentColor = colorValues[--subindex];

                // ...
                if (+0 === --count) { extractionIndex = index; return false; }
                if (stepColor > (currentColor < recentColor ? recentColor - currentColor : currentColor - recentColor)) { ++colorRatios[subindex]; continue extraction }
              }

              if (+0 === colorCount) colorCount = colorRatios.push(1), colorValues.push(currentColor);
              else for (subindex = colorCount; subindex; ) {
                if (currentColor === colorValues[--subindex]) { ++colorRatios[subindex]; break }
                if (+0 === subindex) { colorCount = colorRatios.push(1), colorValues.push(currentColor); break }
              }
            }

            return true
          }

          function filter(count) {
            var count = count;

            // ...
            for (var index, subindex; colorCount > 48 && stepColor !== 0xFFFFFF; stepColor += 0x010101)
            for (index = colorCount; --index; ) {
              currentColor = colorValues[index];

              for (subindex = index - 1; subindex; ) {
                recentColor = colorValues[--subindex];

                if (+0 === --count) return false;
                if (stepColor > (currentColor < recentColor ? recentColor - currentColor : currentColor - recentColor)) {
                  colorRatios[subindex] = colorRatios[index] + colorRatios[subindex];
                  colorValues[subindex] = (
                    (((((currentColor/* >>> 0x00*/) & 0xFF) + ((recentColor/* >>> 0x00*/) & 0xFF)) >>> 1)/* << 0x00*/) |
                    (((((currentColor >>> 0x08) & 0xFF)     + ((recentColor >>> 0x08) & 0xFF))     >>> 1) << 0x08)     |
                    (((((currentColor >>> 0x10)/* & 0xFF*/) + ((recentColor >>> 0x10)/* & 0xFF*/)) >>> 1) << 0x10)
                  );

                  --colorCount;
                  colorRatios[index] = colorRatios[colorCount];
                  colorValues[index] = colorValues[colorCount];

                  colorRatios.pop();
                  colorValues.pop();

                  break
                }
              }
            }

            return true
          }

          function show(output) {
            var download = getElementByClassName(output, "download-link");
            var ranges   = getElementByClassName(output, "ranges");
            var units    = getElementByClassName(output, "units");

            // ...
            if (null !== download) {
              var source = "";

              // ...
              for (var index = +0, length = colorValues.length; index !== length; ++index)
              source += stringify(format.value, colorValues[index]) + (index === length - 1 ? "" : '\n');

              // ...
              if ("function" === typeof File && "function" === typeof URL)
              download.href = URL.createObjectURL(new File([source], "colors.txt", {"type": "text/plain"}))
            }

            if (null !== units) {
              units = getElementByTagName(units, "td");

              if (null !== units) {
                while (units.childNodes.length)
                units.removeChild(units.childNodes.item(+0));

                for (var subindex = +0; subindex !== colorCount; ++subindex) {
                  var color = colorValues[subindex];
                  var unit  = document.createElement("div");

                  // ...
                  unit.className             = "color-unit";
                  unit.style.animationDelay  = (subindex * 30) + "ms";
                  unit.style.backgroundColor = stringify("hexadecimal", color);
                  unit.title                 = stringify(format.value,  color);

                  units.appendChild(unit)
                }
              }
            }

            if (null !== ranges) {
              ranges = getElementByTagName(ranges, "tr");

              if (null !== ranges) {
                while (ranges.childNodes.length)
                ranges.removeChild(ranges.childNodes.item(+0));

                for (var subindex = +0; subindex !== colorCount; ++subindex) {
                  var color = colorValues[subindex];
                  var range = document.createElement("td");
                  var width = colorRatios[subindex];

                  // ...
                  color = "rgb(" + ((color >>> 0x00) & 0xFF) + ", " + ((color >>> 0x08) & 0xFF) + ", " + ((color >>> 0x10) & 0xFF) + ')';

                  range.className             = "color-range";
                  range.style.backgroundColor = color;
                  range.style.width           = (width * 100.0) + '%';
                  range.title                 = color;

                  ranges.appendChild(range)
                }
              }
            }
          }

          function stringify(format, color) {
            var blue  = (color >>> 0x10) & 0xFF;
            var green = (color >>> 0x08) & 0xFF;
            var red   = (color >>> 0x00) & 0xFF;

            // ...
            switch (format) {
              case "cmyk": {
                var yellow  = 1 - (blue  / 255);
                var magenta = 1 - (green / 255);
                var cyan    = 1 - (red   / 255);
                var black   = cyan < magenta ? cyan < yellow ? cyan : magenta < yellow ? magenta : yellow : cyan < yellow ? cyan < magenta ? cyan : magenta < yellow ? magenta : yellow : magenta < yellow ? magenta : yellow;

                // ...
                cyan    = (((cyan    - black) / (1 - black)) * 100) | +0;
                magenta = (((magenta - black) / (1 - black)) * 100) | +0;
                yellow  = (((yellow  - black) / (1 - black)) * 100) | +0;

                return "cmyk(" + cyan + ", " + magenta + ", " + yellow + ", " + (black | +0) + ')'
              } break;

              case "hexadecimal":
                return '#' + "0123456789ABCDEF"[(red >>> 4) % 16] + "0123456789ABCDEF"[(red >>> 0) % 16] + "0123456789ABCDEF"[(green >>> 4) % 16] + "0123456789ABCDEF"[(green >>> 0) % 16] + "0123456789ABCDEF"[(blue >>> 4) % 16] + "0123456789ABCDEF"[(blue >>> 0) % 16];

              case "hsl": {
                var blue  = blue  / 255;
                var green = green / 255;
                var red   = red   / 255;

                var luminosity = blue > green ? blue > red ? blue : green > red ? green : red : blue > red ? blue > green ? blue : green > red ? green : red : green > red ? green : red;
                var saturation = luminosity - (blue < green ? blue < red ? blue : green < red ? green : red : blue < red ? blue < green ? blue : green < red ? green : red : green < red ? green : red);
                var hue        = 60 * (saturation ? luminosity === red ? (green - blue) / saturation : luminosity === green ? 2 + (blue - red) / saturation : 4 + (red - green) / saturation : +0);

                // ...
                return "hsl(" + ((hue < +0 ? hue + 360 : hue) | +0) + ", " + ((100 * (saturation ? saturation / ((luminosity <= 0.5 ? luminosity * 2 : 2 - (luminosity * 2)) - saturation) : +0)) | +0) + ", " + ((100 * ((luminosity * 2) - saturation)) >>> 1) + ')'
              } break;

              case "rgb": default:
                return "rgb(" + red + ", " + green + ", " + blue + ')'
            }

            return ""
          }

          // ...
          disableInput();
          hideTooltip();

          extrapolatingOutput = true;
          input.title         = "Processing picture…";

          // ...
          return false
        }

        // : [Enable Information]
        function enableInformation() {
          var information = getElementByClassName(display, "info-box");
          if (null !== information) information.className = "info-box active"
        }

        // : [Get Element By Class Name] --- UPDATE (Lapys) -> Only recognizes ASCII whitespace as the class name delimiter
        function getElementByClassName(node, className) {
          var classList = split(className);

          // Function > Split ->> Translate `className`s to `classList`s
          function split(name) {
            var index = +0;
            var list  = [""];

            // ...
            for (var subindex = +0; subindex !== name.length; ++subindex)
            switch (name.charAt(subindex)) {
              case ' ': case '\f': case '\n': case '\r': case '\t': case '\v': if ("" !== list[index]) index = list.push("") - 1; break;
              default: list[index] += name.charAt(subindex)
            }

            if ("" === list[index]) list.pop();
            return list
          }

          // ...
          if (+0 !== classList.length) {
            var list       = node.childNodes;
            var queue      = [];
            var queueCount = +0;

            // ...
            while (true) {
              search:
              for (var index = list.length; index; ) {
                var childNode = list.item(--index);

                // ...
                if (0x1 /* --> Node.ELEMENT_NODE */ === childNode.nodeType) {
                  var elementClassName = childNode.className;
                  var elementClassList = null;

                  // ... ->> Assert `className`s directly match
                  queueCount = queue.push(childNode.childNodes);
                  if (className === elementClassName) return childNode;

                  // ... ->> Assert `className` matches node's `classList`
                  elementClassList = split(elementClassName);
                  if (+0 === elementClassList.length) continue search;

                  for (var elementClassListIndex = elementClassList.length; elementClassListIndex; )
                  if (className === elementClassList[--elementClassListIndex]) return childNode;

                  // ... ->> Assert `classList` matches node's `classList`
                  for (var classListIndex = classList.length, classListMatch = true; classListIndex--; ) {
                    for (var elementClassListIndex = elementClassList.length; ; ) {
                      if (classList[classListIndex] === elementClassList[--elementClassListIndex]) break;
                      if (+0 === elementClassListIndex) { classListMatch = false; break }
                    }

                    if (false === classListMatch) break;
                    if (+0 === classListIndex) return childNode
                  }
                }
              }

              // ... --> list = queue.shift(); --queueCount
              if (+0 === queueCount--) break;
              list = queue[+0];

              for (var index = +0; index !== queueCount; ++index) queue[index] = queue[index + 1];
              queue.pop()
            }
          }

          return null
        }

        // : [Get Element By Tag Name]
        function getElementByTagName(node, tagName) {
          return node.getElementsByTagName(tagName).item(+0)
        }

        // : [Hide HUD]
        function hideHUD() {
          var interface = getElementByClassName(display, "input-box");

          if (null === interface) return;
          showingHUD          = false;
          interface.className = "input-box hidden"
        }

        // : [Hide Tooltip]
        function hideTooltip() {
          if (null !== tooltipTarget) {
            tooltipTarget.title = tooltip.innerText;
            tooltip.innerText   = ""
          }

          tooltipTarget     = null;
          tooltip.className = "hidden"
        }

        // : [Process Output] ->> Display specified `input` image
        function processOutput() {
          var adjusted     = false;
          var extrapolated = false;
          var wait = setInterval(function() {
            if (false === image.complete) return;
            if (false === adjusted)     { if (false === adjustOutput())      return; adjusted     = true }
            if (false === extrapolated) { if (false === extrapolateOutput()) return; extrapolated = true }

            display.className = "active";
            output.appendChild(canvas);

            if (null !== text && output === text.parentNode) {
              output.removeChild(text);
              text.data = imageName
            }

            // ...
            clearInterval(wait);
            disableInformation();
            enableInput();
            showOutput()
          });

          // ...
          enableInformation();
          if (null !== text) text.data = "Processing picture…"
        }

        // : [Show HUD]
        function showHUD() {
          var interface = getElementByClassName(display, "input-box");

          if (null === interface) return;
          showingHUD          = true;
          interface.className = "input-box"
        }

        // : [Show Output]
        function showOutput() {
          context.drawImage(image, +0, +0, image.width, image.height, +0, +0, outputWidth, outputHeight);
          return true
        }

        // : [Show Tooltip]
        function showTooltip(target, x, y) {
          if (null === target || tooltipTarget === target)
          return;

          if (0x1 /* --> Node.ELEMENT_NODE */ === target.nodeType && "" !== target.title) {
            tooltipTarget      = target;
            tooltip.style.left = (x +  8) + "px";
            tooltip.style.top  = (y + 16) + "px";
            tooltip.innerText  = target.title;
            tooltip.className  = "";
            target.title       = "";

            return
          }

          hideTooltip()
        }

        // : [Upload Input] ->> Specify `input` image, calls `processOutput()` afterward by modifying `image.src`
        function uploadInput() {
          if ("" === input.value)
          return;

          // ...
          if ("files" in input) {
            var file = input.files.item(+0);

            imageName = file.name;
            if ("function" === typeof URL) {
              if (image.src) URL.revokeObjectURL(image.src);
              image.src = URL.createObjectURL(file);

              return
            }
          }

          // ...
          if ("" === imageName) {
            for (var index = input.value.length; index--; )
            switch (input.value.charAt(index)) {
              case '\\': case '/': index = +0; break;
              default: imageName = input.value.charAt(index) + imageName
            }
          }

          image.src = input.value
        }

        /* ... */
        if (null === context) {
          if (null !== text) text.data = "Unable to display pictures";
          throw new Error("Unable to pick color information from pictures")
        }

        canvas.id  = "canvas";
        imageName = "";

        enableInput();

        /* Event > ... */
        document.onblur = function() { hideTooltip() };

        "function" === typeof document.body.addEventListener                                             ? document.body.addEventListener("mousemove",   function(event) { showTooltip(event.target, event.clientX, event.clientY)     }) :
        "function" === typeof document.body.attachEvent || "object" === typeof document.body.attachEvent ? document.body.attachEvent     ("onmousemove", function(event) { showTooltip(event.srcElement, event.clientX, event.clientY) }) :
        document.body.onmousemove  = function(event) { showTooltip(arguments.length ? "object" === typeof event.target ? event.target : event.srcElement : null, event.clientX, event.clientY) };
        document.body.onmouseleave = function() { hideTooltip() };
        document.body.onresize     = function() { adjustOutput() };

        format.onchange = function() { hideTooltip(); adjustInput(format) };
        format.oninput  = function() { hideTooltip(); adjustInput(format) };

        image.onerror = function() { diagnoseOutput() };
        image.onload  = function() { processOutput() };

        input.onchange = function() { hideTooltip(); uploadInput() };
        input.oninput  = function() { hideTooltip(); uploadInput() };

        step.onchange = function() { hideTooltip(); adjustInput(step) };
        step.oninput  = function() { hideTooltip(); adjustInput(step) };

        toggle.onclick = function() { showingHUD ? hideHUD() : showHUD() }
      }(display, format, input, palette, output, step, output.childNodes.item(+0), toggle, tooltip);
    </script>
  </body>
</html>
