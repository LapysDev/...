<!DOCTYPE html>
<!--[if lt IE 7]> <html class="internet-explorer-5 internet-explorer-6"> <![endif]-->
<!--[if IE 7]> <html class=internet-explorer-7> <![endif]-->
<!--[if IE 8]> <html class=internet-explorer-8> <![endif]-->
<!--[if IE 9]> <html class=internet-explorer-9> <![endif]-->
<html>
<head>
    <!-- Document Metadata -->
        <!-- Character Encoding Set -->
        <meta charset=utf-8>

    <!-- Document Stylesheet -->
    <style media=all type=text/css>
        /* DOM Elements */
            /* All */
            * { box-sizing: inherit }

            /* <body> */
            body { margin: 0 }

            /* <body>, <html>, <main>) */
            body, html, main { height: 100%; width: 100% }

            /* <html> */
            html { box-sizing: border-box }

        /* Components > Canvas */
        #canvas {
            height: 100%;
            outline: 1px solid #CCCCCC;
            width: 100%
        }
    </style>

    <!-- Document Title -->
    <title> WebGL | 1 - The First Triangle </title>
</head>

<body>
    <!-- Main -->
    <main>
        <!-- Canvas -->
        <canvas id=canvas> </canvas>
    </main>

    <!-- Document Script -->
    <script defer language=javascript type=text/javascript>
        /* Global > Canvas, Global, Renderer, Strict */
        const CANVAS = document.getElementById("canvas"),
            GLOBAL = this, RENDERER = CANVAS.getContext("webgl");
        var STRICT = false;

        /* Main */
        (function Main() {
            // Logic
            if (RENDERER === null)
                // Error
                throw new Error("WebGL must be supported");

            else {
                /* Class --- NOTE (Lapys) -> Abstract away the complex stuff. */
                    // Web GL Buffer
                    function WebGLBuffer(context) { return context.createBuffer() }

                    // Web GL Program
                    function WebGLProgram(context) { return context.createProgram() }

                    // Web GL Shader
                    function WebGLShader(context, type, source) {
                        // Constant > Shader
                        const shader = context.createShader(context[type]);

                        // Context
                            // Shader Source --- NOTE (Lapys) -> Source code of the Shader (in the GL shading language).
                            context.shaderSource(shader, source);

                            // Compile Shader
                            context.compileShader(shader);

                        // Return
                        return shader
                    }

                    // Web GL Vertex Array
                    function WebGLVertexArray(vertices) {
                        // Constant > Array
                        const array = [];

                        // Loop > Update > Array
                        vertices.forEach(vertex => array.push(
                            vertex[0] /* NOTE (Lapys) -> X Coordinate. */,
                            vertex[1] /* NOTE (Lapys) -> Y Coordinate. */,
                            vertex[2] /* NOTE (Lapys) -> Z Coordinate. */
                        ));

                        // Return
                        return new Float32Array(array)
                    }

                /* Constant --- NOTE (Lapys) -> Define the necessary components of our current session. */
                    // Buffer
                    const BUFFER = new WebGLBuffer(RENDERER),

                    // Fragment Shader
                    FRAGMENT_SHADER = new WebGLShader(RENDERER, "FRAGMENT_SHADER",
                        // Main
                        "void main() { gl_FragColor = vec4(0, 0, 1, 1) /* NOTE (Lapys) -> RGBA */; }"
                    ),

                    // Program
                    PROGRAM = new WebGLProgram(RENDERER),

                    // Vertex Data --- NOTE (Lapys) -> Vertex points for a 3D triangle.
                    VERTEX_DATA = new WebGLVertexArray([[0, 1, 0], [1, -1, 0], [-1, -1, 0]]),

                    // Vertex Shader
                    VERTEX_SHADER = new WebGLShader(RENDERER, "VERTEX_SHADER",
                        // Initialization > Position --- NOTE (Lapys) -> Referenced later in \`RENDERER.getAttribLocation(...)\`
                        "attribute vec3 position;" +

                        // Main
                        "void main() { gl_Position = vec4(position, 1); }"
                    );

                /* Function > Resize Canvas */
                function resizeCanvas() {
                    /* Modification > (Canvas, Renderer) > ... */
                    CANVAS.height = +(getComputedStyle(CANVAS).getPropertyValue("height").replace("px", ""));
                    CANVAS.width = +(getComputedStyle(CANVAS).getPropertyValue("width").replace("px", ""));

                    RENDERER.drawingBufferHeight = CANVAS.height;
                    RENDERER.drawingBufferWidth = CANVAS.width;
                }; resizeCanvas();

                /* Event > Document > Resize */
                document.addEventListener("resize", resizeCanvas);

                // Renderer --- NOTE (Lapys) -> Set up the defined components and the Renderer.
                    // Bind Buffer --- NOTE (Lapys) -> The buffer is now an array of vertex information.
                    RENDERER.bindBuffer(RENDERER["ARRAY_BUFFER"], BUFFER);

                    // Buffer Data --- NOTE (Lapys) -> Load Vertex Data into Buffer.
                    RENDERER.bufferData(
                        RENDERER["ARRAY_BUFFER"],
                        VERTEX_DATA /* NOTE (Lapys) -> Convert data to a 32-bit floating type. */,
                        RENDERER["STATIC_DRAW"] /* NOTE (Lapys) -> Intent of our data, `STATIC_DRAW` meaning we`ll only draw the data once. */
                    );

                    // Attach Shader
                    RENDERER.attachShader(PROGRAM, FRAGMENT_SHADER);
                    RENDERER.attachShader(PROGRAM, VERTEX_SHADER);

                    // Link Program --- NOTE (Lapys) -> Finish up
                    RENDERER.linkProgram(PROGRAM);

                /* Phase */
                    /* Initiate --- NOTE (Lapys) -> Actually start drawing. */
                    function Initiate() {
                        // Constant > Position Location --- NOTE (Lapys) -> Usually zero.
                        const POSITION_LOCATION = RENDERER.getAttribLocation(PROGRAM, "position");

                        // Renderer
                            // Enable Vertex Attribute Array --- NOTE (Lapys) -> All Attributes are disabled by default.
                            RENDERER.enableVertexAttribArray(POSITION_LOCATION);

                            // Vertex Attribute Pointer
                            RENDERER.vertexAttribPointer(
                                POSITION_LOCATION,
                                3 /* NOTE (Lapys) -> Read these number of elements at a time from Vertex Data. */,
                                RENDERER["FLOAT"] /* NOTE (Lapys) -> The elements are a 32-bit float type. */,
                                STRICT = false /* NOTE (Lapys) -> Normalize: Advanced optimization feature. */,
                                STRICT = 0 /* NOTE (Lapys) -> Stride. */,
                                STRICT = 0 // NOTE (Lapys) -> Offset.
                            );

                            // Use Program --- NOTE (Lapys) -> Send our executable Program to the graphics card.
                            RENDERER.useProgram(PROGRAM);

                            // Draw Arrays --- NOTE (Lapys) -> Draw Vertex Array elements.
                            RENDERER.drawArrays(
                                RENDERER["TRIANGLES"] /* NOTE (Lapys) -> How to draw the elements (points). */,
                                0 /* NOTE (Lapys) -> Starting vertex. */,
                                3 // NOTE (Lapys) -> Number of vertexes to draw.
                            );

                        // Return
                        return 0
                    }

                    /* Update */
                    function Update() { return 0 }

                    /* Reset */
                    function Reset() { return 0 }

                    /* Terminate */
                    function Terminate() { return 0 }

                // Initiate
                Initiate()
            }

            // Return
            return 0
        })()
    </script>
</body>
</html>
